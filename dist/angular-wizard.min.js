/**
 * Easy to use Wizard library for AngularJS
 * @version v0.4.5 - 2015-04-24 * @link https://github.com/mgonto/angular-wizard
 * @author Martin Gontovnikas <martin@gon.to>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
function wizardButtonDirective(a){angular.module("mgo-angular-wizard").directive(a,function(){return{restrict:"A",replace:!1,require:"^wizard",link:function(b,c,d,e){c.on("click",function(c){c.preventDefault(),b.$apply(function(){b.$eval(d[a]),e[a.replace("wz","").toLowerCase()]()})})}}})}angular.module("templates-angularwizard",["step.html","wizard.html"]),angular.module("step.html",[]).run(["$templateCache",function(a){a.put("step.html",'<section ng-show="selected" ng-class="{current: selected, done: completed}" class="step" ng-transclude>\n</section>')}]),angular.module("wizard.html",[]).run(["$templateCache",function(a){a.put("wizard.html",'<div>\n    <div class="steps" ng-transclude></div>\n    <ul class="steps-indicator steps-{{steps.length}}" ng-if="!hideIndicators">\n      <li ng-class="{default: !step.completed && !step.selected, current: step.selected && !step.completed, done: step.completed && !step.selected, editing: step.selected && step.completed}" ng-repeat="step in steps">\n        <a ng-click="goTo(step)">{{step.title || step.wzTitle}}</a>\n      </li>\n    </ul>\n</div>\n')}]),angular.module("mgo-angular-wizard",["templates-angularwizard"]),angular.module("mgo-angular-wizard").directive("wzStep",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{wzTitle:"@",title:"@",canenter:"=",canexit:"="},require:"^wizard",templateUrl:function(a,b){return b.template||"step.html"},link:function(a,b,c,d){a.title=a.title||a.wzTitle,d.addStep(a)}}}),angular.module("mgo-angular-wizard").directive("wizard",["$q",function(a){function b(b,c,d){return a.when("undefined"==typeof b?!0:b(c,d))}return{restrict:"EA",replace:!0,transclude:!0,scope:{currentStep:"=",onFinish:"&",hideIndicators:"=",editMode:"=",name:"@",onEnter:"="},templateUrl:function(a,b){return b.template||"wizard.html"},controller:["$scope","$element","$log","WizardHandler",function(c,d,e,f){function g(){_.each(c.steps,function(a){a.selected=!1}),c.selectedStep=null}var h=!0,i=[];f.addWizard(c.name||f.defaultName,this),c.$on("$destroy",function(){f.removeWizard(c.name||f.defaultName)}),c.steps=[],c.context={},c.$watch("currentStep",function(a){if(a){var b=c.selectedStep.title||c.selectedStep.wzTitle;c.selectedStep&&b!==c.currentStep&&c.goTo(_.findWhere(c.steps,{title:c.currentStep}))}}),c.$watch("[editMode, steps.length]",function(){var a=c.editMode;_.isUndefined(a)||_.isNull(a)||a&&_.each(c.steps,function(a){a.completed=!0})},!0),this.addStep=function(a){c.steps.push(a),1===c.steps.length&&c.goTo(c.steps[0])},this.context=c.context,c.getStepNumber=function(a){return _.indexOf(c.steps,a)+1},c.goTo=function(d){if(!(i.length>0))if(h){var f=!0,j={currentStep:-1,requestedStep:c.getStepNumber(d)};angular.isFunction(c.onEnter)&&(f=c.onEnter(c.context,j,d)),a.when(f).then(function(){g(),c.selectedStep=d,_.isUndefined(c.currentStep)||(c.currentStep=d.title||d.wzTitle),d.selected=!0,c.$emit("wizard:stepChanged",{step:d,index:_.indexOf(c.steps,d)}),h=!1},function(a){e.log("error in onEnter function while changing step",a)})}else{var k,l=!1,m=!1;c.currentStepNumber()>0?k=c.currentStepNumber()-1:0===c.currentStepNumber()&&(k=0);var j={currentStep:k+1,requestedStep:c.getStepNumber(d)};i=[],i.push(b(c.steps[k].canexit,c.context,j).then(function(a){l=a},function(){l=!1})),i.push(b(d.canenter,c.context,j).then(function(a){m=a}),function(){m=!1}),a.all(i)["finally"](function(){if(c.getStepNumber(d)<c.currentStepNumber()&&(l=!0),l&&m){var b=!0;console.log("onEnterFn",c.onEnter),c.onEnter&&(b=c.onEnter(c.context,j,d)),a.when(b).then(function(){g(),c.selectedStep=d,_.isUndefined(c.currentStep)||(c.currentStep=d.title||d.wzTitle),d.selected=!0,c.$emit("wizard:stepChanged",{step:d,index:_.indexOf(c.steps,d)})},function(a){e.log("error in onEnter function while changing step",a)})}})["finally"](function(){i=[]})}},c.currentStepNumber=function(){return _.indexOf(c.steps,c.selectedStep)+1},this.currentStepNumber=function(){return c.currentStepNumber()},this.next=function(a){var b=_.indexOf(c.steps,c.selectedStep);if(angular.isFunction(a)){if(!a())return;b===c.steps.length-1?this.finish():c.goTo(c.steps[b+1])}a||(c.selectedStep.completed=!0),b===c.steps.length-1?this.finish():c.goTo(c.steps[b+1])},this.goTo=function(a){var b;b=_.isNumber(a)?c.steps[a]:_.findWhere(c.steps,{title:a}),c.goTo(b)},this.finish=function(){c.onFinish&&c.onFinish()},this.cancel=this.previous=function(){var a=_.indexOf(c.steps,c.selectedStep);if(0===a)throw new Error("Can't go back. It's already in step 0");c.goTo(c.steps[a-1])}}]}}]),wizardButtonDirective("wzNext"),wizardButtonDirective("wzPrevious"),wizardButtonDirective("wzFinish"),wizardButtonDirective("wzCancel"),angular.module("mgo-angular-wizard").factory("WizardHandler",function(){var a={},b={};return a.defaultName="defaultWizard",a.addWizard=function(a,c){b[a]=c},a.removeWizard=function(a){delete b[a]},a.wizard=function(c){var d=c;return c||(d=a.defaultName),b[d]},a});