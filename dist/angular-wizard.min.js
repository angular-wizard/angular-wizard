/**
 * Easy to use Wizard library for AngularJS
 * @version v0.5.3 - 2015-08-06 * @link https://github.com/mgonto/angular-wizard
 * @author Martin Gontovnikas <martin@gon.to>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="mgo-angular-wizard"),function(a,b,c){function d(a){b.module("mgo-angular-wizard").directive(a,function(){return{restrict:"A",replace:!1,require:"^wizard",link:function(b,c,d,e){c.on("click",function(c){c.preventDefault(),b.$apply(function(){b.$eval(d[a]),e[a.replace("wz","").toLowerCase()]()})})}}})}b.module("templates-angularwizard",["step.html","wizard.html"]),b.module("step.html",[]).run(["$templateCache",function(a){a.put("step.html",'<section ng-show="selected" ng-class="{current: selected, done: completed}" class="step" ng-transclude>\n</section>')}]),b.module("wizard.html",[]).run(["$templateCache",function(a){a.put("wizard.html",'<div>\n    <div class="steps" ng-transclude></div>\n    <ul class="steps-indicator steps-{{steps.length}}" ng-if="!hideIndicators">\n      <li ng-class="{default: !step.completed && !step.selected, current: step.selected && !step.completed, done: step.completed && !step.selected, editing: step.selected && step.completed}" ng-repeat="step in steps">\n        <a ng-click="goTo(step)">{{step.title || step.wzTitle}}</a>\n      </li>\n    </ul>\n</div>\n')}]),b.module("mgo-angular-wizard",["templates-angularwizard"]),b.module("mgo-angular-wizard").directive("wzStep",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{wzTitle:"@",title:"@",canenter:"=",canexit:"="},require:"^wizard",templateUrl:function(a,b){return b.template||"step.html"},link:function(a,b,c,d){a.title=a.title||a.wzTitle,d.addStep(a)}}}),b.module("mgo-angular-wizard").directive("wizard",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{currentStep:"=",onFinish:"&",hideIndicators:"=",editMode:"=",name:"@"},templateUrl:function(a,b){return b.template||"wizard.html"},controller:["$scope","$element","$log","WizardHandler","$q",function(a,d,e,f,g){function h(d){var e,f;return d.canenter===c?!0:"boolean"==typeof d.canenter?d.canenter:(f=d.canenter(a.context),b.isFunction(f.then)?(e=g.defer(),f.then(function(a){e.resolve(a)}),e.promise):d.canenter(a.context)===!0)}function i(c,d){var e,f;return"undefined"==typeof c.canexit||a.getStepNumber(d)<a.currentStepNumber()?!0:"boolean"==typeof c.canexit?c.canexit:(f=c.canexit(a.context),b.isFunction(f.then)?(e=g.defer(),f.then(function(a){e.resolve(a)}),e.promise):c.canexit(a.context)===!0)}function j(){_.each(a.steps,function(a){a.selected=!1}),a.selectedStep=null}var k=!0;f.addWizard(a.name||f.defaultName,this),a.$on("$destroy",function(){f.removeWizard(a.name||f.defaultName)}),a.steps=[],a.context={},a.$watch("currentStep",function(b){if(b){var c=a.selectedStep.title||a.selectedStep.wzTitle;a.selectedStep&&c!==a.currentStep&&a.goTo(_.findWhere(a.steps,{title:a.currentStep}))}}),a.$watch("[editMode, steps.length]",function(){var b=a.editMode;_.isUndefined(b)||_.isNull(b)||b&&_.each(a.steps,function(a){a.completed=!0})},!0),this.addStep=function(b){a.steps.push(b),1===a.steps.length&&a.goTo(a.steps[0])},this.context=a.context,a.getStepNumber=function(b){return _.indexOf(a.steps,b)+1},a.goTo=function(b){if(k)j(),a.selectedStep=b,_.isUndefined(a.currentStep)||(a.currentStep=b.title||b.wzTitle),b.selected=!0,a.$emit("wizard:stepChanged",{step:b,index:_.indexOf(a.steps,b)}),k=!1;else{var c;a.currentStepNumber()>0?c=a.currentStepNumber()-1:0===a.currentStepNumber()&&(c=0),g.all([i(a.steps[c],b),h(b)]).then(function(c){c[0]&&c[1]&&(j(),a.selectedStep=b,_.isUndefined(a.currentStep)||(a.currentStep=b.title||b.wzTitle),b.selected=!0,a.$emit("wizard:stepChanged",{step:b,index:_.indexOf(a.steps,b)}))})}},a.currentStepNumber=function(){return _.indexOf(a.steps,a.selectedStep)+1},this.currentStepNumber=function(){return a.currentStepNumber()},this.next=function(c){var d=_.indexOf(a.steps,a.selectedStep);if(b.isFunction(c)){if(!c())return;d===a.steps.length-1?this.finish():a.goTo(a.steps[d+1])}c||(a.selectedStep.completed=!0),d===a.steps.length-1?this.finish():a.goTo(a.steps[d+1])},this.goTo=function(b){var c;c=_.isNumber(b)?a.steps[b]:_.findWhere(a.steps,{title:b}),a.goTo(c)},this.finish=function(){a.onFinish&&a.onFinish()},this.previous=function(){var b=_.indexOf(a.steps,a.selectedStep);if(0===b)throw new Error("Can't go back. It's already in step 0");a.goTo(a.steps[b-1])},this.cancel=function(){var b=_.indexOf(a.steps,a.selectedStep);if(0===b)throw new Error("Can't go back. It's already in step 0");a.goTo(a.steps[0])}}]}}),d("wzNext"),d("wzPrevious"),d("wzFinish"),d("wzCancel"),b.module("mgo-angular-wizard").factory("WizardHandler",function(){var a={},b={};return a.defaultName="defaultWizard",a.addWizard=function(a,c){b[a]=c},a.removeWizard=function(a){delete b[a]},a.wizard=function(c){var d=c;return c||(d=a.defaultName),b[d]},a})}(window,window.angular);